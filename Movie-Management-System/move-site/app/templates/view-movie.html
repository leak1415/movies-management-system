<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ movie.movie_name }} - Details</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/view.css') }}">
</head>

<body>
    <div class="container">
        <a href="{{ url_for('movie_fr_bp.list_movies') }}">‚Üê Back</a>

        <h1>{{ movie.movie_name }}</h1>

        {% if movie.image %}
        <img src="{{ url_for('static', filename='images/' ~ movie.image) }}" alt="{{ movie.movie_name }}" class="poster">
        {% endif %}

        <!-- Upload poster image -->
        <form id="upload-image-form" method="POST"
              action="{{ url_for('movie_fr_bp.upload_image', movie_id=movie.movie_id) }}"
              enctype="multipart/form-data">
            <input type="file" name="image" id="image_file" accept="image/*">
            <button type="submit">Upload Image</button>
        </form>

        <ul class="movie-details">
            <li><strong>Type:</strong> {{ movie.type }}</li>
            <li><strong>Price:</strong> ${{ movie.price }}</li>
            <li><strong>Quality:</strong> {{ movie.quality }}</li>
            <li><strong>Rating:</strong> {{ movie.rating if movie.rating is not none else 'N/A' }}</li>
            <li><strong>Year:</strong> {{ movie.year if movie.year is not none else 'N/A' }}</li>
            <li><strong>Director:</strong> {{ movie.director if movie.director else 'N/A' }}</li>
            <li><strong>Role:</strong> {{ movie.role if movie.role else 'N/A' }}</li>
            <li><strong>Time:</strong>
                {% if movie.time_watching is not none %}
                    {{ movie.time_watching }} mins
                {% else %}
                    N/A
                {% endif %}
            </li>
            <li><strong>Hall:</strong> {{ movie.hall_name if movie.hall_name else 'N/A' }}</li>
            <li><strong>Chair:</strong> {{ movie.chair_number if movie.chair_number is not none else 'N/A' }}</li>
        </ul>

        <form method="POST" action="{{ url_for('movie_fr_bp.fetch_details', movie_id=movie.movie_id) }}" style="margin: 12px 0;">
            <button type="submit">Fetch details from OMDb</button>
        </form>

        <!-- Trailer display -->
        {% if movie.trailer_file %}
        <video controls class="trailer">
            <source src="{{ url_for('static', filename='trailers/' ~ movie.trailer_file) }}">
            Your browser does not support the video tag.
        </video>
        {% elif movie.trailer_url %}
        {% set embed_url = movie.trailer_url.replace('watch?v=', 'embed/').replace('youtu.be/', 'youtube.com/embed/') %}
        <iframe src="{{ embed_url }}" frameborder="0" allowfullscreen class="trailer"></iframe>
        {% endif %}

        <!-- Upload local trailer -->
        <form id="upload-trailer-form" method="POST"
            action="{{ url_for('movie_fr_bp.upload_trailer', movie_id=movie.movie_id) }}" enctype="multipart/form-data">
            <input type="file" name="trailer_file" id="trailer_file" accept="video/*">
            <button type="submit">Upload Trailer</button>
        </form>

        <!-- YouTube URL -->
        <form method="POST" action="{{ url_for('movie_fr_bp.edit_movie', movie_id=movie.movie_id) }}">
            <input type="text" name="trailer_url" value="{{ movie.trailer_url or '' }}" placeholder="YouTube URL">
            <button type="submit">Save YouTube URL</button>
        </form>
    </div>

    <script>
        document.getElementById('trailer_file')?.addEventListener('change', function () {
            if (this.files && this.files.length) document.getElementById('upload-trailer-form').submit();
        });
        document.getElementById('image_file')?.addEventListener('change', function () {
            if (this.files && this.files.length) document.getElementById('upload-image-form').submit();
        });
    </script>
</body>

</html>
